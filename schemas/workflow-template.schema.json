{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/purlieu-studios/comfyui-mcp/schemas/workflow-template.schema.json",
  "title": "ComfyUI Workflow Template",
  "description": "Schema for ComfyUI workflow templates used in the ComfyUI MCP Server",
  "type": "object",
  "required": ["name", "description", "parameters", "nodes"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Human-readable name of the workflow template",
      "minLength": 1,
      "examples": ["Character Portrait Generator", "Item Icon Generator"]
    },
    "description": {
      "type": "string",
      "description": "Detailed description of what this template generates",
      "minLength": 1,
      "examples": [
        "Generates character portraits for RPG games using Stable Diffusion 1.5",
        "Creates 512x512 centered item icons for inventory systems"
      ]
    },
    "category": {
      "type": ["string", "null"],
      "description": "Template category for organization and filtering",
      "enum": ["character", "item", "environment", "specialized", null],
      "examples": ["character", "item", "environment"]
    },
    "parameters": {
      "type": "object",
      "description": "Dictionary of template parameters that can be customized",
      "additionalProperties": {
        "$ref": "#/definitions/templateParameter"
      },
      "examples": [
        {
          "prompt": {
            "name": "prompt",
            "description": "Text prompt for image generation",
            "type": "string",
            "default": "a warrior in armor",
            "required": true
          },
          "seed": {
            "name": "seed",
            "description": "Random seed for reproducibility",
            "type": "int",
            "default": -1,
            "required": false
          }
        }
      ]
    },
    "nodes": {
      "type": "object",
      "description": "ComfyUI workflow nodes with parameter placeholders",
      "additionalProperties": {
        "$ref": "#/definitions/workflowNode"
      },
      "minProperties": 1,
      "examples": [
        {
          "1": {
            "class_type": "CheckpointLoaderSimple",
            "inputs": {
              "ckpt_name": "v1-5-pruned.safetensors"
            }
          },
          "2": {
            "class_type": "CLIPTextEncode",
            "inputs": {
              "text": "{{prompt}}",
              "clip": ["1", 1]
            }
          }
        }
      ]
    }
  },
  "definitions": {
    "templateParameter": {
      "type": "object",
      "description": "Definition of a customizable template parameter",
      "required": ["name", "description", "type", "default"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Parameter name (must match placeholder in nodes)",
          "pattern": "^[a-zA-Z_][a-zA-Z0-9_]*$",
          "examples": ["prompt", "width", "height", "seed", "steps", "cfg"]
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the parameter",
          "minLength": 1,
          "examples": [
            "Text prompt for image generation",
            "Image width in pixels",
            "Number of sampling steps"
          ]
        },
        "type": {
          "type": "string",
          "description": "Parameter data type",
          "enum": ["string", "int", "float", "bool"],
          "examples": ["string", "int", "float"]
        },
        "default": {
          "description": "Default value for the parameter (type must match 'type' field)",
          "examples": ["a landscape", 512, 7.5, true]
        },
        "required": {
          "type": "boolean",
          "description": "Whether this parameter must be provided",
          "default": true,
          "examples": [true, false]
        }
      },
      "additionalProperties": false
    },
    "workflowNode": {
      "type": "object",
      "description": "A single node in the ComfyUI workflow",
      "required": ["class_type", "inputs"],
      "properties": {
        "class_type": {
          "type": "string",
          "description": "ComfyUI node class type",
          "minLength": 1,
          "examples": [
            "CheckpointLoaderSimple",
            "CLIPTextEncode",
            "KSampler",
            "VAEDecode",
            "SaveImage"
          ]
        },
        "inputs": {
          "type": "object",
          "description": "Node input parameters and connections",
          "additionalProperties": true,
          "examples": [
            {
              "text": "{{prompt}}",
              "clip": ["1", 1]
            },
            {
              "seed": 42,
              "steps": 20,
              "cfg": 7.0,
              "model": ["1", 0]
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "name": "Simple Text-to-Image",
      "description": "Basic text-to-image generation workflow",
      "category": "character",
      "parameters": {
        "prompt": {
          "name": "prompt",
          "description": "Text prompt",
          "type": "string",
          "default": "a warrior",
          "required": true
        },
        "seed": {
          "name": "seed",
          "description": "Random seed",
          "type": "int",
          "default": -1,
          "required": false
        }
      },
      "nodes": {
        "1": {
          "class_type": "CheckpointLoaderSimple",
          "inputs": {
            "ckpt_name": "v1-5-pruned.safetensors"
          }
        },
        "2": {
          "class_type": "CLIPTextEncode",
          "inputs": {
            "text": "{{prompt}}",
            "clip": ["1", 1]
          }
        },
        "3": {
          "class_type": "KSampler",
          "inputs": {
            "seed": "{{seed}}",
            "steps": 20,
            "cfg": 7.0,
            "model": ["1", 0],
            "positive": ["2", 0]
          }
        }
      }
    }
  ]
}
